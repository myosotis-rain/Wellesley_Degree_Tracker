<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Wellesley Academic Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 text-slate-900">
  <div id="root" class="min-h-screen"></div>

  <!-- React + ReactDOM + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;
    const cx = (...c) => c.filter(Boolean).join(" ");
    const clamp01 = (x) => Math.max(0, Math.min(1, x));

    // ---- Requirements model ----
    const generalRequirements = [
      { id: "UNITS", label: "Total Units (32)", targetCount: 32 },
      { id: "WRIT", label: "First-Year Writing", targetCount: 1 },
      { id: "LANG", label: "Foreign Language", targetCount: 2 },
      { id: "QR",   label: "Quantitative Reasoning", targetCount: 1 },
      { id: "300",  label: "300-level Courses", targetCount: 4 },
      { id: "PE",   label: "Physical Education*", targetCount: 8 },
      { id: "EXP",  label: "Experiential Learning", targetCount: 2 },
    ];

    const distributionRequirements = [
      { id: "GROUP1_TOTAL", label: "Group 1: Humanities & Arts", targetCount: 3 },
      { id: "GROUP2_TOTAL", label: "Group 2: Social Sciences", targetCount: 3 },
      { id: "GROUP3_TOTAL", label: "Group 3: Science & Math", targetCount: 3 },
    ];

    const seedRequirements = [...generalRequirements, ...distributionRequirements];

    // Internal tracking (not displayed in requirements list)
    const internalRequirements = [
      { id: "LL",   label: "Language & Literature", targetCount: 1 },
      { id: "ARTS", label: "Visual Arts, Music, Theatre, Film, Video", targetCount: 1 },
      { id: "SBA",  label: "Social & Behavioral Analysis", targetCount: 1 },
      { id: "EC",   label: "Epistemology & Cognition", targetCount: 1 },
      { id: "REP",  label: "Religion, Ethics & Moral Philosophy", targetCount: 1 },
      { id: "HST",  label: "Historical Studies", targetCount: 1 },
      { id: "NPS",  label: "Natural & Physical Science", targetCount: 1 },
      { id: "MM",   label: "Mathematical Modeling", targetCount: 1 },
      { id: "LAB",  label: "Laboratory Course", targetCount: 1 },
    ];

    const requirementTagOptions = [
      { id: "WRIT", label: "WRIT" },
      { id: "LANG", label: "LANG" },
      { id: "QR",   label: "QR" },
      { id: "DL",   label: "DL" },
      { id: "LL",   label: "LL" },
      { id: "ARTS", label: "ARTS" },
      { id: "SBA",  label: "SBA" },
      { id: "EC",   label: "EC" },
      { id: "HST",  label: "HST" },
      { id: "REP",  label: "REP" },
      { id: "MM",   label: "MM" },
      { id: "NPS",  label: "NPS" },
      { id: "LAB",  label: "LAB" },
      { id: "300",  label: "300" },
      { id: "PE",   label: "PE" },
      { id: "EXP",  label: "EXP" },
    ];

    const wellesleyDeptOptions = [
      "Africana Studies","American Studies","Anthropology","Art","Art History",
      "Astronomy","Biological Sciences","Chemistry","Cinema and Media Studies",
      "Classical Studies","Cognitive and Linguistic Science","Computer Science",
      "Economics","English","Environmental Studies","French","Geosciences",
      "German","History","International Relations","Mathematics","Music",
      "Neuroscience","Philosophy","Physics","Political Science","Psychology",
      "Quantitative Reasoning","Religion","Russian","Sociology","Spanish",
      "Statistics","Theatre Studies","Women's and Gender Studies","Writing Program",
    ];

    const courseCodeToDepartment = {
      // Core Academic Departments
      "AFR": "Africana Studies",
      "AMST": "American Studies", 
      "ANTH": "Anthropology",
      "ARAB": "International Relations", // Arabic studies
      "ARCH": "Art",
      "ARTH": "Art History",
      "ARTS": "Art",
      "ASTR": "Astronomy",
      "BIOC": "Biological Sciences", // Biochemistry
      "BISC": "Biological Sciences",
      "BIOL": "Biological Sciences",
      "CAMS": "Cinema and Media Studies",
      "CHEM": "Chemistry",
      "CHIN": "International Relations", // Chinese
      "CLCV": "Classical Studies", // Classical Civilization
      "COGS": "Cognitive and Linguistic Science",
      "CS": "Computer Science",
      "ECON": "Economics",
      "EDST": "Environmental Studies", // Education Studies
      "ENG": "English",
      "ENGL": "English",
      "ENVS": "Environmental Studies",
      "ES": "Environmental Studies",
      "FREN": "French",
      "GEOS": "Geosciences",
      "GER": "German", 
      "GRMN": "German",
      "HIST": "History",
      "HNUR": "International Relations", // Hindi/Urdu
      "ITAL": "International Relations", // Italian
      "JAPN": "International Relations", // Japanese
      "JWST": "Religion", // Jewish Studies
      "KOR": "International Relations", // Korean
      "LANG": "International Relations", // Language courses
      "LAST": "American Studies", // Latino Studies
      "LING": "Cognitive and Linguistic Science",
      "MATH": "Mathematics",
      "MELA": "International Relations", // Middle Eastern Languages
      "MUS": "Music",
      "NEUR": "Neuroscience",
      "PHIL": "Philosophy",
      "PHYS": "Physics",
      "POL": "Political Science",
      "POLS": "Political Science", 
      "PSYC": "Psychology",
      "QR": "Quantitative Reasoning",
      "REL": "Religion",
      "RELI": "Religion",
      "RUSS": "Russian",
      "SCI": "Environmental Studies", // Science courses
      "SOC": "Sociology",
      "SPAN": "Spanish",
      "STAT": "Statistics",
      "THST": "Theatre Studies",
      "WGST": "Women's and Gender Studies",
      "WRIT": "Writing Program",
      "PE": "Physical Education",
      "MAS": "Media Arts and Sciences",
      "CAMS": "Cinema and Media Studies"
    };

    const detectDepartmentFromCode = (courseCode) => {
      if (!courseCode) return null;
      
      // Extract department code (letters before numbers)
      const match = courseCode.trim().toUpperCase().match(/^([A-Z]+)/);
      if (!match) return null;
      
      const deptCode = match[1];
      return courseCodeToDepartment[deptCode] || null;
    };

    const newSlot = () => ({
      code: "",
      title: "",
      credits: 1.0,
      tags: [],
      depts: [],
      source: "Wellesley",
      level: 100,
    });

    const defaultYears = [
      { id: 1, label: "First Year", termLabels: ["Fall", "Spring", "Summer", "Winter"] },
      { id: 2, label: "Sophomore Year", termLabels: ["Fall", "Spring", "Summer", "Winter"] },
      { id: 3, label: "Junior Year", termLabels: ["Fall", "Spring", "Summer", "Winter"] },
      { id: 4, label: "Senior Year", termLabels: ["Fall", "Spring", "Summer", "Winter"] },
    ];

    const getDefaultTerms = (startYear = 2024) => [
      { id: "Y1-F", label: `Fall ${startYear}`,  year: 1, calendarYear: startYear, season: "Fall" },
      { id: "Y1-S", label: `Spring ${startYear + 1}`, year: 1, calendarYear: startYear + 1, season: "Spring" },
      { id: "Y2-F", label: `Fall ${startYear + 1}`,   year: 2, calendarYear: startYear + 1, season: "Fall" },
      { id: "Y2-S", label: `Spring ${startYear + 2}`, year: 2, calendarYear: startYear + 2, season: "Spring" },
      { id: "Y3-F", label: `Fall ${startYear + 2}`,      year: 3, calendarYear: startYear + 2, season: "Fall" },
      { id: "Y3-S", label: `Spring ${startYear + 3}`,    year: 3, calendarYear: startYear + 3, season: "Spring" },
      { id: "Y4-F", label: `Fall ${startYear + 3}`,      year: 4, calendarYear: startYear + 3, season: "Fall" },
      { id: "Y4-S", label: `Spring ${startYear + 4}`,    year: 4, calendarYear: startYear + 4, season: "Spring" },
    ].map(t => ({ ...t, slots: [newSlot(), newSlot(), newSlot(), newSlot()] }));

    // ---- UI helpers ----
    const Pill = ({ children, className }) => (
      <span className={cx("inline-flex items-center rounded-full border px-2 py-1 text-xs", className)}>
        {children}
      </span>
    );

    const RingStat = ({ pct, label, subtitle }) => {
      const p = clamp01(pct);
      const deg = p * 360;
      return (
        <div className="flex flex-col items-center text-center text-xs">
          <div className="relative h-20 w-20">
            <div
              className="absolute inset-0 rounded-full"
              style={{
                background: `conic-gradient(#1e40af ${deg}deg, #e5e7eb 0deg)`,
              }}
            />
            <div className="absolute inset-2 rounded-full bg-white flex items-center justify-center">
              <span className="text-sm font-semibold text-slate-900">
                {Math.round(p * 100)}%
              </span>
            </div>
          </div>
          <div className="mt-1 text-[0.7rem] font-medium text-slate-800">{label}</div>
          {subtitle && (
            <div className="mt-0.5 text-[0.65rem] text-slate-500">{subtitle}</div>
          )}
        </div>
      );
    };

    const MiniReqBar = ({ label, have, target }) => {
      const pct = clamp01(target ? have / target : 0);
      return (
        <div className="mb-2">
          <div className="flex items-center justify-between text-[0.7rem]">
            <span>{label}</span>
            <span className="text-[0.65rem]">
              {have}/{target}
            </span>
          </div>
          <div className="mt-1 h-1.5 w-full overflow-hidden rounded-full bg-slate-200">
            <div
              className="h-full rounded-full bg-indigo-500"
              style={{ width: `${pct * 100}%` }}
            />
          </div>
        </div>
      );
    };

    // ---- Editable Year Label ----
    const EditableYearLabel = ({ year, onUpdate }) => {
      const [isEditing, setIsEditing] = useState(false);
      const [tempLabel, setTempLabel] = useState(year.label || "");
      
      useEffect(() => {
        setTempLabel(year.label || "");
      }, [year.label]);
      
      const handleSubmit = () => {
        if (tempLabel.trim() && tempLabel !== year.label) {
          onUpdate(year.id, tempLabel.trim());
        }
        setIsEditing(false);
      };
      
      const handleCancel = () => {
        setTempLabel(year.label);
        setIsEditing(false);
      };
      
      if (isEditing) {
        return (
          <div className="flex items-center gap-1">
            <input
              type="text"
              value={tempLabel}
              onChange={(e) => setTempLabel(e.target.value)}
              className="rounded border px-2 py-1 text-sm font-semibold text-slate-800"
              onKeyDown={(e) => {
                if (e.key === 'Enter') handleSubmit();
                if (e.key === 'Escape') handleCancel();
              }}
              onBlur={handleSubmit}
              autoFocus
            />
            <button
              type="button"
              onClick={handleSubmit}
              className="text-[0.6rem] text-green-600 hover:text-green-700"
            >
              ✓
            </button>
            <button
              type="button"
              onClick={handleCancel}
              className="text-[0.6rem] text-red-600 hover:text-red-700"
            >
              ×
            </button>
          </div>
        );
      }
      
      return (
        <button
          type="button"
          onClick={() => setIsEditing(true)}
          className="text-sm font-semibold text-slate-800 hover:text-indigo-600 underline decoration-dotted"
        >
          {year.label}
        </button>
      );
    };

    // ---- Term cards (left column) ----
    const TermSummaryCard = ({ term, onOpen, onRemove, canRemove, onYearChange }) => {
      const nonEmptySlots = term.slots.filter(s => s.code || s.title);
      const [isEditingYear, setIsEditingYear] = useState(false);
      const [tempYear, setTempYear] = useState(term.calendarYear);
      
      const handleYearSubmit = () => {
        if (tempYear !== term.calendarYear) {
          onYearChange(term.id, tempYear);
        }
        setIsEditingYear(false);
      };
      
      const handleYearCancel = () => {
        setTempYear(term.calendarYear);
        setIsEditingYear(false);
      };
      
      return (
        <div className="relative group">
          <div
            onClick={onOpen}
            className="group flex h-full w-full flex-col rounded-xl border bg-white px-3 py-2 text-left shadow-sm transition hover:-translate-y-0.5 hover:shadow-md cursor-pointer"
          >
          <div className="mb-1 flex items-center justify-between">
            <div className="flex items-center gap-1">
              <div className="text-[0.75rem] font-semibold text-slate-800">
                {term.season || term.label.split(' ')[0]}
              </div>
              {isEditingYear ? (
                <div className="flex items-center gap-1" onClick={(e) => e.stopPropagation()}>
                  <input
                    type="number"
                    value={tempYear}
                    onChange={(e) => setTempYear(parseInt(e.target.value))}
                    className="w-16 rounded border px-1 text-[0.65rem]"
                    onKeyDown={(e) => {
                      if (e.key === 'Enter') handleYearSubmit();
                      if (e.key === 'Escape') handleYearCancel();
                    }}
                    autoFocus
                  />
                  <button
                    type="button"
                    onClick={handleYearSubmit}
                    className="text-[0.6rem] text-green-600 hover:text-green-700"
                  >
                    ✓
                  </button>
                  <button
                    type="button"
                    onClick={handleYearCancel}
                    className="text-[0.6rem] text-red-600 hover:text-red-700"
                  >
                    ×
                  </button>
                </div>
              ) : (
                <button
                  type="button"
                  onClick={(e) => {
                    e.stopPropagation();
                    setIsEditingYear(true);
                  }}
                  className="text-[0.65rem] text-slate-500 hover:text-indigo-600 underline"
                >
                  {term.calendarYear}
                </button>
              )}
            </div>
            <span className="text-[0.65rem] text-slate-400 group-hover:text-indigo-500">
              Edit
            </span>
          </div>
          <div className="space-y-1 text-[0.7rem]">
            {nonEmptySlots.length === 0 && (
              <div className="rounded-lg border border-dashed border-slate-200 bg-slate-50 px-2 py-2 text-[0.65rem] text-slate-400">
                No courses yet. Click to add.
              </div>
            )}
            {nonEmptySlots.slice(0, 3).map((s, i) => (
              <div key={i} className="flex items-start justify-between">
                <div className="truncate">
                  <div className="text-[0.7rem] font-medium truncate">
                    {s.code || "Course"}
                  </div>
                  <div className="text-[0.65rem] text-slate-500 truncate">
                    {s.title || "Tap to edit details"}
                  </div>
                </div>
                <div className="ml-2 text-[0.65rem] text-slate-500">
                  {(s.credits || 0).toFixed(1)}
                </div>
              </div>
            ))}
            {nonEmptySlots.length > 3 && (
              <div className="text-[0.6rem] text-slate-400">
                + {nonEmptySlots.length - 3} more…
              </div>
            )}
          </div>
          </div>
          {canRemove && (
            <button
              type="button"
              onClick={(e) => {
                e.stopPropagation();
                onRemove();
              }}
              className="absolute -right-2 -top-2 rounded-full border border-rose-200 bg-white px-2 py-0.5 text-[0.6rem] text-rose-600 opacity-0 shadow-sm transition hover:bg-rose-50 group-hover:opacity-100"
            >
              ×
            </button>
          )}
        </div>
      );
    };

    // ---- Term detail modal ----
    function TermDetailModal({ term, onClose, updateSlot, addSlot, removeSlot }) {
      if (!term) return null;

      const updateField = (slotIdx, field, value) => {
        updateSlot(term.id, slotIdx, (s) => {
          const updated = { ...s, [field]: value };
          // Auto-detect course level and department from course code
          if (field === 'code' && value) {
            const codeUpper = value.trim().toUpperCase();
            const match = codeUpper.match(/([A-Z]+)\s*(\d{3})/); // Find department and 3-digit number
            if (match) {
              const deptCode = match[1];
              const courseNum = parseInt(match[2]);
              
              // Set course level
              if (courseNum >= 100 && courseNum < 200) updated.level = 100;
              else if (courseNum >= 200 && courseNum < 300) updated.level = 200;
              else if (courseNum >= 300) updated.level = 300;
              
              // Auto-set PE courses to 4.0 credits
              if (deptCode === 'PE') {
                updated.credits = 4.0;
              }
              
              // Auto-detect department from course code
              const detectedDept = detectDepartmentFromCode(deptCode);
              if (detectedDept && s.source === "Wellesley") {
                updated.depts = [detectedDept];
              }
              
              // Auto-add 300-level tag for distribution requirement
              if (courseNum >= 300) {
                if (!updated.tags.includes("300")) {
                  updated.tags = [...(updated.tags || []), "300"];
                }
              } else {
                // Remove 300 tag if not 300-level
                updated.tags = updated.tags.filter(tag => tag !== "300");
              }
              
              // Auto-detect common distribution requirements based on department
              const autoTags = [];
              switch (deptCode) {
                case 'MATH':
                case 'STAT':
                  if (!updated.tags.includes("QR")) autoTags.push("QR");
                  if (!updated.tags.includes("MM")) autoTags.push("MM");
                  break;
                case 'ENG':
                case 'ENGL':
                  if (!updated.tags.includes("LL")) autoTags.push("LL");
                  break;
                case 'WRIT':
                  if (!updated.tags.includes("WRIT")) autoTags.push("WRIT");
                  break;
                case 'BISC':
                case 'BIOL':
                case 'CHEM':
                case 'PHYS':
                case 'ASTR':
                case 'GEOS':
                  if (!updated.tags.includes("NPS")) autoTags.push("NPS");
                  if (codeUpper.includes('LAB') || courseNum >= 200) {
                    if (!updated.tags.includes("LAB")) autoTags.push("LAB");
                  }
                  break;
                case 'ECON':
                case 'POLS':
                case 'POL':
                case 'SOC':
                case 'ANTH':
                  if (!updated.tags.includes("SBA")) autoTags.push("SBA");
                  break;
                case 'PHIL':
                case 'REL':
                case 'RELI':
                  if (!updated.tags.includes("REP")) autoTags.push("REP");
                  break;
                case 'PSYC':
                case 'COGS':
                  if (!updated.tags.includes("EC")) autoTags.push("EC");
                  break;
                case 'HIST':
                  if (!updated.tags.includes("HST")) autoTags.push("HST");
                  break;
                case 'ARTS':
                case 'MUS':
                case 'THST':
                case 'CAMS':
                  if (!updated.tags.includes("ARTS")) autoTags.push("ARTS");
                  break;
                case 'PE':
                  if (!updated.tags.includes("PE")) autoTags.push("PE");
                  break;
              }
              
              // Add auto-detected tags
              autoTags.forEach(tag => {
                if (!updated.tags.includes(tag)) {
                  updated.tags = [...updated.tags, tag];
                }
              });
            }
          }
          return updated;
        });
      };

      const toggleTag = (slotIdx, id) => {
        updateSlot(term.id, slotIdx, (s) => {
          const has = s.tags.includes(id);
          return { ...s, tags: has ? s.tags.filter(t => t !== id) : [...s.tags, id] };
        });
      };

      const toggleDept = (slotIdx, dept) => {
        updateSlot(term.id, slotIdx, (s) => {
          const has = s.depts.includes(dept);
          return { ...s, depts: has ? s.depts.filter(d => d !== dept) : [...s.depts, dept] };
        });
      };

      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40">
          <div className="max-h-[90vh] w-full max-w-3xl overflow-y-auto rounded-2xl bg-white p-5 shadow-xl">
            <div className="mb-4 flex items-center justify-between">
              <div>
                <div className="text-xs uppercase tracking-wide text-slate-500">
                  Edit term
                </div>
                <div className="text-sm font-semibold text-slate-900">{term.label}</div>
              </div>
              <button
                type="button"
                onClick={onClose}
                className="rounded-full border px-3 py-1 text-xs hover:bg-slate-50"
              >
                ✕ Close
              </button>
            </div>

            <div className="space-y-3 text-xs">
              {term.slots.map((slot, i) => (
                <div key={i} className="rounded-xl border p-3">
                  <div className="mb-2 flex items-center justify-between">
                    <div className="flex items-center gap-2">
                      <span className="text-[0.7rem] font-semibold text-slate-800">
                        Course {i + 1}
                      </span>
                      {slot.tags.length > 0 && (
                        <div className="flex flex-wrap gap-1">
                          {slot.tags.map(t => (
                            <span
                              key={t}
                              className="rounded-full bg-indigo-50 px-2 py-0.5 text-[0.6rem] text-indigo-700"
                            >
                              {t}
                            </span>
                          ))}
                        </div>
                      )}
                    </div>
                    <button
                      type="button"
                      onClick={() => removeSlot(term.id, i)}
                      className="rounded-full border border-rose-200 px-2 py-0.5 text-[0.6rem] text-rose-600 hover:bg-rose-50"
                    >
                      Remove
                    </button>
                  </div>

                  <div className="grid gap-2 md:grid-cols-5">
                    <input
                      className="rounded-lg border px-2 py-1 text-[0.7rem] md:col-span-1"
                      placeholder="Code (e.g. CS 111)"
                      value={slot.code}
                      onChange={(e) => updateField(i, "code", e.target.value)}
                    />
                    <input
                      className="rounded-lg border px-2 py-1 text-[0.7rem] md:col-span-3"
                      placeholder="Title"
                      value={slot.title}
                      onChange={(e) => updateField(i, "title", e.target.value)}
                    />
                    <input
                      className="rounded-lg border px-2 py-1 text-[0.7rem] md:col-span-1"
                      placeholder="Units"
                      type="number"
                      min="0"
                      step="0.25"
                      value={slot.credits}
                      onChange={(e) =>
                        updateField(i, "credits", parseFloat(e.target.value || "0"))
                      }
                    />
                  </div>

                  <div className="mt-2 grid gap-2 md:grid-cols-3">
                    <div className="rounded-lg border bg-slate-50 px-2 py-2">
                      <div className="mb-1 text-[0.7rem] font-semibold text-slate-700">
                        Requirement tags
                      </div>
                      <div className="flex flex-wrap gap-1">
                        {requirementTagOptions.map(opt => {
                          const active = slot.tags.includes(opt.id);
                          return (
                            <button
                              key={opt.id}
                              type="button"
                              onClick={() => toggleTag(i, opt.id)}
                              className={cx(
                                "rounded-full border px-2 py-0.5 text-[0.65rem]",
                                active
                                  ? "border-indigo-600 bg-indigo-600 text-white"
                                  : "border-slate-300 bg-white text-slate-700"
                              )}
                            >
                              {opt.label}
                            </button>
                          );
                        })}
                      </div>
                    </div>

                    <div className="rounded-lg border bg-slate-50 px-2 py-2">
                      <div className="mb-1 flex items-center justify-between text-[0.7rem]">
                        <span className="font-semibold text-slate-700">
                          Department(s)
                        </span>
                        <select
                          className="rounded-md border px-1 py-0.5 text-[0.65rem]"
                          value={slot.source}
                          onChange={(e) => updateField(i, "source", e.target.value)}
                        >
                          <option>Wellesley</option>
                          <option>MIT</option>
                          <option>Babson</option>
                          <option>Olin</option>
                          <option>StudyAbroad</option>
                          <option>Transfer</option>
                          <option>Other</option>
                        </select>
                      </div>

                      {slot.source === "Wellesley" ? (
                        <div className="flex max-h-28 flex-wrap gap-1 overflow-y-auto pr-1">
                          {wellesleyDeptOptions.map(name => {
                            const active = slot.depts.includes(name);
                            return (
                              <button
                                key={name}
                                type="button"
                                onClick={() => toggleDept(i, name)}
                                className={cx(
                                  "rounded-full border px-2 py-0.5 text-[0.65rem]",
                                  active
                                    ? "border-sky-600 bg-sky-600 text-white"
                                    : "border-slate-300 bg-white text-slate-700"
                                )}
                              >
                                {name}
                              </button>
                            );
                          })}
                        </div>
                      ) : (
                        <input
                          className="mt-1 w-full rounded-lg border px-2 py-1 text-[0.7rem]"
                          placeholder="Dept / program (e.g. MIT EECS)"
                          value={slot.depts[0] || ""}
                          onChange={(e) => updateField(i, "depts", [e.target.value])}
                        />
                      )}
                    </div>

                    <div className="rounded-lg border bg-slate-50 px-2 py-2">
                      <div className="mb-1 text-[0.7rem] font-semibold text-slate-700">
                        Notes
                      </div>
                      <textarea
                        className="h-20 w-full rounded-lg border px-2 py-1 text-[0.7rem]"
                        placeholder="Optional notes about why you're taking this, cross-reg info, etc."
                      />
                    </div>
                  </div>
                </div>
              ))}
            </div>

            <div className="mt-4 flex justify-center">
              <button
                type="button"
                onClick={() => addSlot(term.id)}
                className="rounded-full bg-indigo-600 px-4 py-1.5 text-xs font-medium text-white hover:bg-indigo-700"
              >
                + Add course
              </button>
            </div>
          </div>
        </div>
      );
    }

    // ---- Major Requirements ----
    const majorRequirements = {
      "Computer Science": {
        requiredCourses: ["CS 111", "CS 230", "CS 231", "CS 235"],
        electiveCourses: 4,
        mathRequirements: ["MATH 115", "MATH 116"],
        description: "Complete foundation courses, 4 electives, and math requirements"
      },
      "Mathematics": {
        requiredCourses: ["MATH 115", "MATH 116", "MATH 205", "MATH 206"],
        electiveCourses: 6,
        description: "Complete calculus sequence and 6 advanced electives"
      },
      "Economics": {
        requiredCourses: ["ECON 101", "ECON 102", "ECON 103"],
        electiveCourses: 5,
        mathRequirements: ["QR 140" ,"ECON 103"],
        description: "Complete core sequence and 5 electives with quantitative focus"
      },
      "Media Arts and Sciences": {
        introductoryCourses: {
          visualAnalysis: ["ARTH 100", "WRIT 107", "CAMS 100"],
          studioFoundation: ["Any 100-level ARTS course"],
          computerScience: ["Any 100-level CS course"]
        },
        coreCourses: {
          studioCore: [
            "ARTS 205", "ARTS 207", "ARTS 208", "ARTS 216", "ARTS 219", "ARTS 220", 
            "ARTS 221", "ARTS 222", "ARTS 223", "ARTS 255", "ARTS 260", "ARTS 265",
            "ARTS 307", "ARTS 308", "ARTS 313", "ARTS 317H", "ARTS 318H", "ARTS 321",
            "ARTS 322", "ARTS 323", "ARTS 336", "ARTS 365", "ARTS 366", "CAMS 301",
            "MUS 275", "MUS 277"
          ],
          csCore: [
            "CS 110", "CS 111", "CS 121", "CS 200", "CS 204", "CS 220", "CS 221",
            "CS 230", "CS 232", "CS 304", "CS 307", "CS 315", "CS 317", "CS 320",
            "CS 321", "CS 323", "CS 325", "CS 365", "CS 366"
          ]
        },
        capstoneRequired: 1,
        capstoneCourses: [
          "ARTS 321", "ARTS 322", "ARTS 365", "ARTS 366", "CS 365", "CS 366"
        ],
        mediaCulture: 1,
        advancedProduction: 1,
        portfolioRequired: true,
        description: "Interdisciplinary major combining studio arts, computer science, and media culture. Requires 3 intro courses, 6 core courses (3 studio + 3 CS), 1 capstone, and portfolio."
      }
    };

    // ---- Local Storage Helper Functions ----
    const STORAGE_KEY = "wellesley_degree_tracker";
    
    const saveToLocalStorage = (data) => {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      } catch (error) {
        console.warn("Failed to save to localStorage:", error);
      }
    };
    
    const loadFromLocalStorage = () => {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        return saved ? JSON.parse(saved) : null;
      } catch (error) {
        console.warn("Failed to load from localStorage:", error);
        return null;
      }
    };

    // ---- Main App ----
    function App() {
      // Load saved data or use defaults
      const savedData = loadFromLocalStorage();
      
      const [terms, setTerms] = useState(savedData?.terms || getDefaultTerms());
      const [activeTermId, setActiveTermId] = useState(null);
      const [activeTab, setActiveTab] = useState(savedData?.activeTab || "plan");
      const [startYear, setStartYear] = useState(savedData?.startYear || 2024);
      const [selectedMajor, setSelectedMajor] = useState(savedData?.selectedMajor || "Computer Science");
      const [yearLabels, setYearLabels] = useState(savedData?.yearLabels || Object.fromEntries(defaultYears.map(y => [y.id, y.label])));
      const [languageWaived, setLanguageWaived] = useState(savedData?.languageWaived || false);

      const termById = (id) => terms.find(t => t.id === id) || null;

      // Auto-save to localStorage whenever data changes
      useEffect(() => {
        const dataToSave = {
          terms,
          activeTab,
          startYear,
          selectedMajor,
          yearLabels,
          languageWaived
        };
        saveToLocalStorage(dataToSave);
      }, [terms, activeTab, startYear, selectedMajor, yearLabels, languageWaived]);

      const updateSlot = (termId, slotIdx, updater) => {
        setTerms(prev =>
          prev.map(t =>
            t.id !== termId
              ? t
              : {
                  ...t,
                  slots: t.slots.map((s, i) =>
                    i === slotIdx ? updater(s || newSlot()) : s
                  ),
                }
          )
        );
      };

      const addSlot = (termId) => {
        setTerms(prev =>
          prev.map(t =>
            t.id !== termId
              ? t
              : { ...t, slots: [...t.slots, newSlot()] }
          )
        );
      };

      const removeSlot = (termId, slotIdx) => {
        setTerms(prev =>
          prev.map(t =>
            t.id !== termId
              ? t
              : { ...t, slots: t.slots.filter((_, i) => i !== slotIdx) }
          )
        );
      };

      const removeTerm = (termId) => {
        setTerms(prev => prev.filter(t => t.id !== termId));
        if (activeTermId === termId) setActiveTermId(null);
      };

      const addTerm = (year, season) => {
        const baseYearTerms = terms.filter(t => t.year === year);
        const latestCalendarYear = baseYearTerms.length > 0 
          ? Math.max(...baseYearTerms.map(t => t.calendarYear || startYear))
          : startYear + (year - 1);
          
        let actualYear;
        if (season === 'Fall' || season === 'Winter') {
          actualYear = startYear + (year - 1);
        } else if (season === 'Spring' || season === 'Summer') {
          actualYear = startYear + year;
        }
        
        const seasonId = season === 'Summer' ? 'U' : season === 'Winter' ? 'W' : season.charAt(0);
        const newTerm = {
          id: `Y${year}-${seasonId}`,
          label: `${season} ${actualYear}`,
          year: year,
          season: season,
          calendarYear: actualYear,
          slots: [newSlot(), newSlot()]
        };
        
        setTerms(prev => [...prev, newTerm]);
      };

      const addYear = () => {
        const maxYear = Math.max(...terms.map(t => t.year), 0);
        const newYear = maxYear + 1;
        const latestCalendarYear = Math.max(...terms.map(t => t.calendarYear || startYear), startYear);
        
        const newTerms = [
          {
            id: `Y${newYear}-F`,
            label: `Fall ${latestCalendarYear + newYear - 1}`,
            year: newYear,
            season: "Fall",
            calendarYear: latestCalendarYear + newYear - 1,
            slots: [newSlot(), newSlot(), newSlot(), newSlot()]
          },
          {
            id: `Y${newYear}-S`,
            label: `Spring ${latestCalendarYear + newYear}`,
            year: newYear,
            season: "Spring", 
            calendarYear: latestCalendarYear + newYear,
            slots: [newSlot(), newSlot(), newSlot(), newSlot()]
          }
        ];
        
        setTerms(prev => [...prev, ...newTerms]);
      };

      const updateTermYear = (termId, newCalendarYear) => {
        setTerms(prev => prev.map(t => {
          if (t.id !== termId) return t;
          const season = t.season || (t.id.includes('-F') ? 'Fall' : t.id.includes('-S') ? 'Spring' : t.id.includes('-U') ? 'Summer' : 'Winter');
          
          return {
            ...t,
            calendarYear: newCalendarYear,
            label: `${season} ${newCalendarYear}`
          };
        }));
      };

      const updateStartYear = (year) => {
        setStartYear(year);
        setTerms(getDefaultTerms(year));
      };

      const updateYearLabel = (yearId, newLabel) => {
        setYearLabels(prev => ({
          ...prev,
          [yearId]: newLabel
        }));
      };

      const years = defaultYears.map(y => ({
        ...y,
        label: yearLabels[y.id] || y.label
      }));

      // ---- Progress calculations ----
      const progress = useMemo(() => {
        const allRequirements = [...seedRequirements, ...internalRequirements];
        const counts = Object.fromEntries(allRequirements.map(r => [r.id, 0]));
        let totalUnits = 0;
        let level300 = 0;

        terms.forEach(t =>
          t.slots.forEach(s => {
            if (!(s.code || s.title)) return;
            const credits = Number(s.credits || 0);
            totalUnits += credits;
            if (s.level >= 300) level300 += 1;
            s.tags.forEach(tag => {
              if (!counts[tag]) counts[tag] = 0;
              counts[tag] += 1;
            });
          })
        );

        counts.UNITS = totalUnits;
        counts["300"] = level300;

        // Calculate group totals based on Wellesley's actual requirements
        const c = (id) => counts[id] || 0;
        
        // Group 1: LL + ARTS (need at least 1 from each, 3 total)
        counts.GROUP1_TOTAL = c("LL") + c("ARTS");
        
        // Group 2: SBA (required) + 2 from EC/REP/HST (3 total)  
        counts.GROUP2_TOTAL = c("SBA") + c("EC") + c("REP") + c("HST");
        
        // Group 3: NPS + MM + additional from either (3 total, at least 1 lab)
        counts.GROUP3_TOTAL = c("NPS") + c("MM");

        const detail = seedRequirements.map(r => {
          let have = counts[r.id] || 0;
          let pct = clamp01(have / (r.targetCount || 1));
          
          // Handle language waiver
          if (r.id === "LANG" && languageWaived) {
            have = r.targetCount; // Mark as completed
            pct = 1;
          }
          
          // Special logic for group requirements
          if (r.id === "GROUP1_TOTAL") {
            // Must have at least 1 LL AND 1 ARTS, plus total of 3
            const hasLL = c("LL") >= 1;
            const hasARTS = c("ARTS") >= 1;
            const hasTotal = counts.GROUP1_TOTAL >= 3;
            pct = (hasLL && hasARTS && hasTotal) ? 1 : clamp01(counts.GROUP1_TOTAL / 3);
          } else if (r.id === "GROUP2_TOTAL") {
            // Must have SBA + at least 2 from EC/REP/HST
            const hasSBA = c("SBA") >= 1;
            const ehrCount = Math.min(c("EC") + c("REP") + c("HST"), 2);
            const total = (hasSBA ? 1 : 0) + ehrCount;
            have = total;
            pct = clamp01(total / 3);
          } else if (r.id === "GROUP3_TOTAL") {
            // Must have NPS + MM + at least 1 more, with at least 1 lab
            const hasNPS = c("NPS") >= 1;
            const hasMM = c("MM") >= 1;
            const hasLab = c("LAB") >= 1;
            const additionalNeeded = Math.max(0, 3 - c("NPS") - c("MM"));
            const hasEnoughTotal = counts.GROUP3_TOTAL >= 3;
            have = counts.GROUP3_TOTAL + (hasLab && !hasMM && !hasNPS ? 1 : 0); // Count lab separately if needed
            pct = (hasNPS && hasMM && hasLab && hasEnoughTotal) ? 1 : clamp01(counts.GROUP3_TOTAL / 3);
          }
          
          return { ...r, have, pct };
        });

        const overall = detail.reduce((sum, r) => sum + r.pct, 0) / detail.length;

        // Simplified group calculation for display
        const g1 = clamp01(counts.GROUP1_TOTAL / 3);
        const g2 = clamp01(counts.GROUP2_TOTAL / 3); 
        const g3 = clamp01(counts.GROUP3_TOTAL / 3);

        return {
          detail,
          counts,
          overall,
          totalUnits,
          dist3x3: { g1, g2, g3 },
        };
      }, [terms]);

      const getReq = (id) => progress.detail.find(r => r.id === id) || { have: 0, targetCount: 1, pct: 0 };

      const canRemoveTerm = (termId) => {
        const maxYear = Math.max(...terms.map(t => t.year));
        const term = termById(termId);
        // Allow removal of any term from the highest year, or any Summer/Winter term
        return term && (term.year === maxYear || term.season === 'Summer' || term.season === 'Winter');
      };
      
      const addRemovedTerm = (year, season) => {
        // This allows re-adding removed terms
        addTerm(year, season);
      };

      // ---- Views ----
      const renderPlan = () => (
        <div className="grid gap-4 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]">
          {/* Left: four rows (First/Soph/Junior/Senior) */}
          <div className="space-y-4">
            {/* Start Year Control - only on left side */}
            <div className="flex items-center gap-3 rounded-xl border bg-white p-3">
              <label className="text-sm font-medium text-slate-700">Start Year:</label>
              <input
                type="number"
                value={startYear}
                onChange={(e) => updateStartYear(parseInt(e.target.value))}
                className="w-20 rounded border px-2 py-1 text-sm"
                min="2020"
                max="2030"
              />
              <button
                type="button"
                onClick={addYear}
                className="rounded bg-indigo-600 px-3 py-1 text-sm font-medium text-white hover:bg-indigo-700"
              >
                + Add Remaining Years
              </button>
            </div>
            
            {years.map(y => {
              const fallId = `Y${y.id}-F`;
              const springId = `Y${y.id}-S`;
              const summerId = `Y${y.id}-U`;
              const winterId = `Y${y.id}-W`;
              const fall = termById(fallId);
              const spring = termById(springId);
              const summer = termById(summerId);
              const winter = termById(winterId);

              return (
                <div key={y.id} className="rounded-2xl border bg-white/70 p-3">
                  <div className="mb-2 flex items-center justify-between">
                    <EditableYearLabel year={y} onUpdate={updateYearLabel} />
                    <div className="flex gap-1 text-xs">
                      {!fall && (
                        <button
                          onClick={() => addTerm(y.id, 'Fall')}
                          className="rounded bg-amber-100 px-2 py-1 text-amber-700 hover:bg-amber-200"
                        >
                          + Fall
                        </button>
                      )}
                      {!spring && (
                        <button
                          onClick={() => addTerm(y.id, 'Spring')}
                          className="rounded bg-emerald-100 px-2 py-1 text-emerald-700 hover:bg-emerald-200"
                        >
                          + Spring
                        </button>
                      )}
                      {!summer && (
                        <button
                          onClick={() => addTerm(y.id, 'Summer')}
                          className="rounded bg-orange-100 px-2 py-1 text-orange-700 hover:bg-orange-200"
                        >
                          + Summer
                        </button>
                      )}
                      {!winter && (
                        <button
                          onClick={() => addTerm(y.id, 'Winter')}
                          className="rounded bg-blue-100 px-2 py-1 text-blue-700 hover:bg-blue-200"
                        >
                          + Winter
                        </button>
                      )}
                    </div>
                  </div>
                  <div className="grid gap-2 grid-cols-2">
                    {/* Arrange terms in chronological order: Fall, Winter, Spring, Summer */}
                    {fall && (
                      <TermSummaryCard
                        term={fall}
                        onOpen={() => setActiveTermId(fall.id)}
                        onRemove={() => removeTerm(fall.id)}
                        canRemove={canRemoveTerm(fall.id)}
                        onYearChange={updateTermYear}
                      />
                    )}
                    {winter && (
                      <TermSummaryCard
                        term={winter}
                        onOpen={() => setActiveTermId(winter.id)}
                        onRemove={() => removeTerm(winter.id)}
                        canRemove={canRemoveTerm(winter.id)}
                        onYearChange={updateTermYear}
                      />
                    )}
                    {spring && (
                      <TermSummaryCard
                        term={spring}
                        onOpen={() => setActiveTermId(spring.id)}
                        onRemove={() => removeTerm(spring.id)}
                        canRemove={canRemoveTerm(spring.id)}
                        onYearChange={updateTermYear}
                      />
                    )}
                    {summer && (
                      <TermSummaryCard
                        term={summer}
                        onOpen={() => setActiveTermId(summer.id)}
                        onRemove={() => removeTerm(summer.id)}
                        canRemove={canRemoveTerm(summer.id)}
                        onYearChange={updateTermYear}
                      />
                    )}
                  </div>
                </div>
              );
            })}
            </div>

          {/* Right: visuals / stats */}
          <div className="space-y-3">
            <div className="rounded-2xl border bg-white p-3">
              <div className="mb-3 flex items-center justify-between">
                <div className="text-sm font-semibold text-slate-900">
                  Degree snapshot
                </div>
              </div>
              <div className="flex justify-around gap-3">
                <RingStat
                  pct={progress.totalUnits / 32}
                  label="Units toward 32"
                  subtitle={`${progress.totalUnits.toFixed(1)} / 32`}
                />
                <RingStat
                  pct={(progress.dist3x3.g1 + progress.dist3x3.g2 + progress.dist3x3.g3) / 3}
                  label="Distributions (3–3–3)"
                  subtitle="Avg of Groups 1–3"
                />
              </div>
            </div>

            <div className="rounded-2xl border bg-white p-3 text-[0.75rem]">
              <div className="mb-2 text-sm font-semibold text-slate-900">
                Distribution Groups (3-3-3)
              </div>
              <MiniReqBar
                label="Group 1: Humanities & Arts"
                have={getReq("GROUP1_TOTAL").have}
                target={3}
              />
              <div className="text-[0.6rem] text-slate-500 ml-2 mb-2">
                (≥1 Language/Lit + ≥1 Arts, 3 total)
              </div>
              <MiniReqBar
                label="Group 2: Social Sciences"
                have={getReq("GROUP2_TOTAL").have}
                target={3}
              />
              <div className="text-[0.6rem] text-slate-500 ml-2 mb-2">
                (1 SBA + 2 from EC/REP/HST)
              </div>
              <MiniReqBar
                label="Group 3: Science & Math"
                have={getReq("GROUP3_TOTAL").have}
                target={3}
              />
              <div className="text-[0.6rem] text-slate-500 ml-2">
                (1 Science + 1 Math + 1 more, ≥1 lab)
              </div>
            </div>

            <div className="rounded-2xl border bg-white p-3 text-[0.75rem]">
              <div className="mb-2 text-sm font-semibold text-slate-900">
                Other Requirements
              </div>
              <MiniReqBar label="First-Year Writing" have={getReq("WRIT").have} target={1} />
              <MiniReqBar 
                label={`Foreign Language${languageWaived ? " (Waived)" : ""}`} 
                have={getReq("LANG").have} 
                target={2} 
              />
              <MiniReqBar label="Quantitative Reasoning" have={getReq("QR").have} target={1} />
              <MiniReqBar label="300-level Courses" have={getReq("300").have} target={4} />
              <div className="mb-2">
                <div className="flex items-center justify-between text-[0.7rem]">
                  <span>
                    Physical Education* 
                    <span className="ml-1 text-[0.6rem] text-slate-500">(*One PE class = 4 units)</span>
                  </span>
                  <span className="text-[0.65rem]">
                    {getReq("PE").have}/{getReq("PE").targetCount}
                  </span>
                </div>
                <div className="mt-1 h-1.5 w-full overflow-hidden rounded-full bg-slate-200">
                  <div
                    className="h-full rounded-full bg-indigo-500"
                    style={{ width: `${getReq("PE").pct * 100}%` }}
                  />
                </div>
              </div>
              <MiniReqBar label="Experiential Learning" have={getReq("EXP").have} target={2} />
            </div>

            <div className="rounded-2xl border bg-white p-3 text-[0.75rem]">
              <div className="mb-2 flex items-center justify-between">
                <div className="text-sm font-semibold text-slate-900">
                  Major progress
                </div>
              </div>
              <div className="flex items-center gap-3">
                <div className="relative h-16 w-16">
                  <div
                    className="absolute inset-0 rounded-full"
                    style={{
                      background: `conic-gradient(#4f46e5 ${getReq("300").pct * 360}deg, #e5e7eb 0deg)`,
                    }}
                  />
                  <div className="absolute inset-2 flex items-center justify-center rounded-full bg-white">
                    <span className="text-xs font-semibold text-slate-900">
                      {getReq("300").have}/{getReq("300").targetCount}
                    </span>
                  </div>
                </div>
                <div className="flex-1 text-[0.7rem] text-slate-700">
                  Track 300-level seminars and major requirements here.  
                  For a real deployment, this could be tied to a specific major’s checklist.
                </div>
              </div>
            </div>
          </div>
        </div>
      );

      const renderRequirements = () => (
        <div className="mt-4 space-y-4">
          {/* General Requirements */}
          <div className="rounded-2xl border bg-white p-4 text-xs">
            <div className="mb-3 flex items-center justify-between">
              <div className="text-sm font-semibold text-slate-900">
                General Requirements
              </div>
              <label className="flex items-center gap-2 text-[0.7rem]">
                <input
                  type="checkbox"
                  checked={languageWaived}
                  onChange={(e) => setLanguageWaived(e.target.checked)}
                  className="rounded"
                />
                Waive Language Requirement
              </label>
            </div>
            <div className="grid gap-3 md:grid-cols-2 lg:grid-cols-3">
              {progress.detail.filter(r => generalRequirements.some(gr => gr.id === r.id)).map(r => (
                <div key={r.id} className="rounded-xl border px-3 py-2">
                  <div className="mb-1 flex items-center justify-between">
                    <span className="text-[0.75rem] font-medium text-slate-800">
                      {r.label}
                      {r.id === "LANG" && languageWaived && (
                        <span className="ml-1 text-green-600">(Waived)</span>
                      )}
                      {r.id === "PE" && (
                        <span className="ml-2 text-[0.6rem] text-slate-500">
                          (*One PE class = 4 units)
                        </span>
                      )}
                    </span>
                    <span className="text-[0.7rem] text-slate-500">
                      {r.have}/{r.targetCount}
                    </span>
                  </div>
                  <div className="h-1.5 w-full overflow-hidden rounded-full bg-slate-200">
                    <div
                      className={cx(
                        "h-full rounded-full",
                        r.id === "LANG" && languageWaived ? "bg-green-600" : "bg-indigo-600"
                      )}
                      style={{ width: `${r.pct * 100}%` }}
                    />
                  </div>
                </div>
              ))}
            </div>
          </div>

          {/* Distribution Requirements */}
          <div className="rounded-2xl border bg-white p-4 text-xs">
            <div className="mb-3 text-sm font-semibold text-slate-900">
              Distribution Requirements (3-3-3)
            </div>
            <div className="grid gap-3 md:grid-cols-1 lg:grid-cols-3">
              {progress.detail.filter(r => distributionRequirements.some(dr => dr.id === r.id)).map(r => (
                <div key={r.id} className="rounded-xl border px-3 py-2">
                  <div className="mb-1 flex items-center justify-between">
                    <span className="text-[0.75rem] font-medium text-slate-800">
                      {r.label}
                    </span>
                    <span className="text-[0.7rem] text-slate-500">
                      {r.have}/{r.targetCount}
                    </span>
                  </div>
                  <div className="h-1.5 w-full overflow-hidden rounded-full bg-slate-200">
                    <div
                      className="h-full rounded-full bg-green-600"
                      style={{ width: `${r.pct * 100}%` }}
                    />
                  </div>
                  <div className="mt-1 text-[0.65rem] text-slate-500">
                    {r.id === 'GROUP1_TOTAL' && '(≥1 Language/Lit + ≥1 Arts, 3 total)'}
                    {r.id === 'GROUP2_TOTAL' && '(1 SBA + 2 from EC/REP/HST)'}
                    {r.id === 'GROUP3_TOTAL' && '(1 Science + 1 Math + 1 more, ≥1 lab)'}
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      );

      const renderCourses = () => {
        const rows = [];
        terms.forEach(t => {
          t.slots.forEach(s => {
            if (!(s.code || s.title)) return;
            rows.push({ term: t.label, ...s });
          });
        });

        return (
          <div className="mt-4 rounded-2xl border bg-white p-4 text-xs">
            <div className="mb-3 text-sm font-semibold text-slate-900">
              Planned courses
            </div>
            {rows.length === 0 ? (
              <div className="text-[0.75rem] text-slate-500">
                No courses yet. Add courses from the Planner tab.
              </div>
            ) : (
              <div className="overflow-x-auto">
                <table className="min-w-full border-collapse text-[0.75rem]">
                  <thead className="bg-slate-50">
                    <tr>
                      <th className="border-b px-2 py-1 text-left">Term</th>
                      <th className="border-b px-2 py-1 text-left">Code</th>
                      <th className="border-b px-2 py-1 text-left">Title</th>
                      <th className="border-b px-2 py-1 text-left">Units</th>
                      <th className="border-b px-2 py-1 text-left">Tags</th>
                      <th className="border-b px-2 py-1 text-left">Departments</th>
                    </tr>
                  </thead>
                  <tbody>
                    {rows.map((r, idx) => (
                      <tr key={idx} className="odd:bg-white even:bg-slate-50/60">
                        <td className="border-b px-2 py-1">{r.term}</td>
                        <td className="border-b px-2 py-1">{r.code}</td>
                        <td className="border-b px-2 py-1">{r.title}</td>
                        <td className="border-b px-2 py-1">{r.credits}</td>
                        <td className="border-b px-2 py-1">
                          {r.tags.join(", ")}
                        </td>
                        <td className="border-b px-2 py-1">
                          {r.depts.join(" / ")}
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </div>
        );
      };

      const renderMASMajor = (majorReq, allCourses) => {
        // Check introductory courses
        const visualAnalysis = allCourses.filter(course => 
          majorReq.introductoryCourses.visualAnalysis.some(req => course.code.includes(req.replace(" ", " ")))
        );
        const studioFoundation = allCourses.filter(course => 
          course.code.match(/^ARTS\s+1\d{2}/)
        );
        const csIntro = allCourses.filter(course => 
          course.code.match(/^CS\s+1\d{2}/)
        );
        
        // Check core courses
        const studioCore = allCourses.filter(course =>
          majorReq.coreCourses.studioCore.some(req => course.code === req)
        );
        const csCore = allCourses.filter(course =>
          majorReq.coreCourses.csCore.some(req => course.code === req)
        );
        
        // Check capstone
        const capstone = allCourses.filter(course =>
          majorReq.capstoneCourses.some(req => course.code === req)
        );
        
        return (
          <div className="mt-4 space-y-4">
            <div className="rounded-2xl border bg-white p-4">
              <div className="mb-3 flex items-center justify-between">
                <div className="text-sm font-semibold text-slate-900">Media Arts and Sciences Major</div>
                <select
                  value={selectedMajor}
                  onChange={(e) => setSelectedMajor(e.target.value)}
                  className="rounded border px-3 py-1 text-sm"
                >
                  {Object.keys(majorRequirements).map(major => (
                    <option key={major} value={major}>{major}</option>
                  ))}
                </select>
              </div>
              
              <div className="mb-4 text-xs text-slate-600">
                {majorReq.description}
              </div>
              
              <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
                {/* Introductory Requirements */}
                <div className="rounded-lg border p-3">
                  <div className="mb-2 text-sm font-medium">Introductory Courses (3 required)</div>
                  <div className="space-y-2 text-xs">
                    <div className={cx(
                      "p-2 rounded",
                      visualAnalysis.length > 0 ? "bg-green-50 text-green-700" : "bg-gray-50 text-gray-600"
                    )}>
                      <div className="font-medium">Visual Analysis</div>
                      <div className="text-[0.65rem]">ARTH 100/WRIT 107 or CAMS 100</div>
                      {visualAnalysis.length > 0 && <div className="text-[0.6rem] mt-1">✓ {visualAnalysis[0].code}</div>}
                    </div>
                    <div className={cx(
                      "p-2 rounded",
                      studioFoundation.length > 0 ? "bg-green-50 text-green-700" : "bg-gray-50 text-gray-600"
                    )}>
                      <div className="font-medium">Studio Foundation</div>
                      <div className="text-[0.65rem]">Any 100-level ARTS course</div>
                      {studioFoundation.length > 0 && <div className="text-[0.6rem] mt-1">✓ {studioFoundation[0].code}</div>}
                    </div>
                    <div className={cx(
                      "p-2 rounded",
                      csIntro.length > 0 ? "bg-green-50 text-green-700" : "bg-gray-50 text-gray-600"
                    )}>
                      <div className="font-medium">Computer Science</div>
                      <div className="text-[0.65rem]">Any 100-level CS course</div>
                      {csIntro.length > 0 && <div className="text-[0.6rem] mt-1">✓ {csIntro[0].code}</div>}
                    </div>
                  </div>
                  <div className="mt-2 text-xs text-slate-500">
                    {(visualAnalysis.length > 0 ? 1 : 0) + (studioFoundation.length > 0 ? 1 : 0) + (csIntro.length > 0 ? 1 : 0)}/3 completed
                  </div>
                </div>
                
                {/* Core Courses */}
                <div className="rounded-lg border p-3">
                  <div className="mb-2 text-sm font-medium">Core Courses (6 required)</div>
                  <div className="space-y-2 text-xs">
                    <div className="p-2 bg-blue-50 rounded">
                      <div className="font-medium">Studio Core (3 required)</div>
                      <div className="text-[0.65rem] text-slate-600">Choose from ARTS/CAMS/MUS studio courses</div>
                      {studioCore.slice(0, 3).map((course, i) => (
                        <div key={i} className="text-[0.6rem] text-blue-700 mt-1">✓ {course.code}</div>
                      ))}
                      <div className="text-[0.6rem] mt-1">{Math.min(studioCore.length, 3)}/3 completed</div>
                    </div>
                    <div className="p-2 bg-purple-50 rounded">
                      <div className="font-medium">CS Core (3 required)</div>
                      <div className="text-[0.65rem] text-slate-600">Choose from CS core courses</div>
                      {csCore.slice(0, 3).map((course, i) => (
                        <div key={i} className="text-[0.6rem] text-purple-700 mt-1">✓ {course.code}</div>
                      ))}
                      <div className="text-[0.6rem] mt-1">{Math.min(csCore.length, 3)}/3 completed</div>
                    </div>
                  </div>
                </div>
                
                {/* Capstone & Other Requirements */}
                <div className="rounded-lg border p-3">
                  <div className="mb-2 text-sm font-medium">Additional Requirements</div>
                  <div className="space-y-2 text-xs">
                    <div className={cx(
                      "p-2 rounded",
                      capstone.length > 0 ? "bg-green-50 text-green-700" : "bg-gray-50 text-gray-600"
                    )}>
                      <div className="font-medium">Capstone Course</div>
                      <div className="text-[0.65rem]">1 required (senior year)</div>
                      {capstone.length > 0 && <div className="text-[0.6rem] mt-1">✓ {capstone[0].code}</div>}
                    </div>
                    <div className="p-2 bg-yellow-50 rounded">
                      <div className="font-medium">Media Culture Course</div>
                      <div className="text-[0.65rem]">1 recommended</div>
                    </div>
                    <div className="p-2 bg-orange-50 rounded">
                      <div className="font-medium">Online Portfolio</div>
                      <div className="text-[0.65rem]">Required senior year</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      };

      const renderMajor = () => {
        const majorReq = majorRequirements[selectedMajor];
        if (!majorReq) return null;
        
        const allCourses = [];
        terms.forEach(t => {
          t.slots.forEach(s => {
            if (s.code || s.title) {
              allCourses.push(s);
            }
          });
        });
        
        // Handle different major structures
        if (selectedMajor === "Media Arts and Sciences") {
          return renderMASMajor(majorReq, allCourses);
        }
        
        const completedRequired = majorReq.requiredCourses ? majorReq.requiredCourses.filter(req => 
          allCourses.some(course => course.code === req)
        ) : [];
        
        const majorElectives = allCourses.filter(course => {
          const dept = detectDepartmentFromCode(course.code);
          const majorDept = selectedMajor === "Computer Science" ? "Computer Science" : 
                           selectedMajor === "Mathematics" ? "Mathematics" :
                           selectedMajor === "Economics" ? "Economics" : null;
          return dept === majorDept && !majorReq.requiredCourses?.includes(course.code) && course.level >= 200;
        });
        
        const completedMath = majorReq.mathRequirements ? 
          majorReq.mathRequirements.filter(req => 
            allCourses.some(course => course.code === req)
          ) : [];
        
        return (
          <div className="mt-4 space-y-4">
            <div className="rounded-2xl border bg-white p-4">
              <div className="mb-3 flex items-center justify-between">
                <div className="text-sm font-semibold text-slate-900">Major Requirements</div>
                <select
                  value={selectedMajor}
                  onChange={(e) => setSelectedMajor(e.target.value)}
                  className="rounded border px-3 py-1 text-sm"
                >
                  {Object.keys(majorRequirements).map(major => (
                    <option key={major} value={major}>{major}</option>
                  ))}
                </select>
              </div>
              
              <div className="mb-4 text-xs text-slate-600">
                {majorReq.description}
              </div>
              
              <div className="grid gap-4 md:grid-cols-3">
                <div className="rounded-lg border p-3">
                  <div className="mb-2 text-sm font-medium">Required Courses</div>
                  <div className="space-y-1 text-xs">
                    {majorReq.requiredCourses.map(course => (
                      <div key={course} className={cx(
                        "flex items-center justify-between p-2 rounded",
                        completedRequired.includes(course) 
                          ? "bg-green-50 text-green-700" 
                          : "bg-gray-50 text-gray-600"
                      )}>
                        <span>{course}</span>
                        {completedRequired.includes(course) && <span>✓</span>}
                      </div>
                    ))}
                  </div>
                  <div className="mt-2 text-xs text-slate-500">
                    {completedRequired.length}/{majorReq.requiredCourses.length} completed
                  </div>
                </div>
                
                <div className="rounded-lg border p-3">
                  <div className="mb-2 text-sm font-medium">Major Electives</div>
                  <div className="space-y-1 text-xs">
                    {majorElectives.map((course, idx) => (
                      <div key={idx} className="p-2 bg-blue-50 text-blue-700 rounded">
                        {course.code} - {course.title}
                      </div>
                    ))}
                  </div>
                  <div className="mt-2 text-xs text-slate-500">
                    {majorElectives.length}/{majorReq.electiveCourses} completed
                  </div>
                </div>
                
                {majorReq.mathRequirements && (
                  <div className="rounded-lg border p-3">
                    <div className="mb-2 text-sm font-medium">Math Requirements</div>
                    <div className="space-y-1 text-xs">
                      {majorReq.mathRequirements.map(course => (
                        <div key={course} className={cx(
                          "flex items-center justify-between p-2 rounded",
                          completedMath.includes(course) 
                            ? "bg-green-50 text-green-700" 
                            : "bg-gray-50 text-gray-600"
                        )}>
                          <span>{course}</span>
                          {completedMath.includes(course) && <span>✓</span>}
                        </div>
                      ))}
                    </div>
                    <div className="mt-2 text-xs text-slate-500">
                      {completedMath.length}/{majorReq.mathRequirements.length} completed
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      };

      return (
        <div className="mx-auto max-w-6xl p-6">
          {/* Top bar */}
          <header className="mb-4 flex flex-col gap-3 border-b pb-3 sm:flex-row sm:items-center sm:justify-between">
            <div className="flex-1">
              <h1 className="text-xl font-semibold text-slate-900">
                Wellesley Academic Planner
              </h1>
              <p className="text-xs text-slate-500">
                Plan academic years, track requirements, and see your progress at a glance.
              </p>
            </div>
            <nav className="flex gap-2 text-xs">
                {[
                  { id: "plan", label: "Planner" },
                  { id: "reqs", label: "Requirements" },
                  { id: "courses", label: "Courses" },
                  { id: "major", label: "Major" },
                ].map(tab => (
                  <button
                    key={tab.id}
                    type="button"
                    onClick={() => setActiveTab(tab.id)}
                    className={cx(
                      "rounded-full px-3 py-1.5",
                      activeTab === tab.id
                        ? "bg-slate-900 text-white"
                        : "bg-white text-slate-700 border"
                    )}
                  >
                    {tab.label}
                  </button>
                ))}
              </nav>
          </header>

          {activeTab === "plan" && renderPlan()}
          {activeTab === "reqs" && renderRequirements()}
          {activeTab === "courses" && renderCourses()}
          {activeTab === "major" && renderMajor()}

          <TermDetailModal
            term={activeTermId ? termById(activeTermId) : null}
            onClose={() => setActiveTermId(null)}
            updateSlot={updateSlot}
            addSlot={addSlot}
            removeSlot={removeSlot}
          />
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
